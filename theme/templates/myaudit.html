{% extends "base_loggedin.html" %}

{% block content %}
<div class="pt-10 pb-8 px-6 lg:px-8" style="margin-left: 256px;">
    
    <div class="max-w-7xl mx-auto">
        <h2 class="text-2xl font-semibold text-gray-100 mb-6 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a.75.75 0 01-.75.75h-1.5a.75.75 0 01-.75-.75V15M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm-1.5 0V18m-2.25-7.5h3m-6.75 7.5h.75a.75.75 0 00.75-.75V18a.75.75 0 00-.75-.75h-.75a.75.75 0 00-.75.75v2.25a.75.75 0 00.75.75z" />
            </svg>
            Previous Audits
        </h2>

        <div class="overflow-hidden rounded-lg shadow-lg ring-1 ring-black/5 bg-transparent">
            <table class="min-w-full divide-y divide-gray-700 text-gray-100">
                <thead class="bg-gray-700/50">
                    <tr>
                        <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold uppercase tracking-wider text-gray-300">
                            <span class="lg:pl-0">Report Name</span>
                        </th>
                        <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold uppercase tracking-wider text-gray-300">
                            Generated At
                        </th>
                        <th scope="col" class="px-6 py-3.5 text-left text-sm font-semibold uppercase tracking-wider text-gray-300">
                            Status
                        </th>
                        <th scope="col" class="relative px-6 py-3.5">
                            <span class="sr-only">Actions</span>
                        </th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                    {% if previous_audits %}
                        {% for audit in previous_audits %}
                            <tr class="hover:bg-gray-600/50 transition-colors" data-audit-id="{{ audit.id }}">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100">
                                    <div class="flex items-center gap-x-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-gray-400">
                                            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12 6.75a.75.75 0 00-.75.75v6a.75.75 0 001.5 0v-6a.75.75 0 00-.75-.75zM12 15.75a.75.75 0 01-.75-.75h1.5a.75.75 0 01-.75.75z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="truncate">{{ audit.report_name }}</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        Generated by:
                                        <span class="font-mono text-gray-300">{{ username|default:"System" }}</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                    <time datetime="{{ audit.created_at|date:'c' }}" class="block">
                                        {{ audit.created_at|date:"D, M d, Y H:i:s" }}
                                    </time>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    {% if audit.status == "completed" %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-green-500/20 text-green-400">
                                            <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
                                                <path d="M39.7 11.3l-1.5 1.5 3.5 3.5-7.5 1.5 1.5-7.5 3.5 3.5 1.5-1.5-5.7-5.7z" transform="translate(0 0) scale(1 1)" />
                                            </svg>
                                            Completed
                                        </span>
                                    {% elif audit.status == "pending" %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-yellow-500/20 text-yellow-300">
                                            <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-yellow-300 animate-pulse"  viewBox="0 0 8 8">
                                              <circle cx="4" cy="4" r="3" fill="currentColor" />
                                            </svg>
                                            Pending
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-red-500/20 text-red-400">
                                            <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-red-400" fill="currentColor" viewBox="0 0 8 8">
                                                <path d="M4 0a4 4 0 100 8 4 4 0 000-8zM2 4a2 2 0 114 0 2 2 0 01-4 0z" />
                                            </svg>
                                            {{ audit.status|default:"Unknown" }}
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex justify-end gap-2">
                                        <a href="{% url 'view_report' filename=audit.report_name %}" class="text-indigo-400 hover:text-indigo-300 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md flex items-center gap-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322c1.397-.228 3.022-0.538 4.653-0.852m4.653 0a4.492 4.492 0 014.653 0M19.5 14.285a4.492 4.492 0 01-4.657-0.853M5.5 12.322l-.317-.024a6.07 6.07 0 00-4.5 0L1.964 12.322m6.06-2.984l-.001-.014a4.12 4.12 0 00-4.079-3.902M19.5 14.285l.317.024a6.07 6.07 0 004.5 0L22.036 14.285m-6.06 2.984l.001.014a4.12 4.12 0 014.079 3.902m-9.06-5.686l-2.81-.024a6.43 6.43 0 01-5.014-3.985m12.028 0l2.81.024a6.43 6.43 0 005.014 3.985m-3.004 1.695l-.001.014a4.64 4.64 0 01-4.08 3.902M16.5 9.715l.001-.014a4.64 4.64 0 014.08 3.902m-6.016-5.858l-2.81-.024A6.43 6.43 0 007.5 5.61m12.026 0l2.81.024A6.43 6.43 0 0116.5 9.715m-3.004 1.695l-.001.014a4.64 4.64 0 01-4.079-3.902M9.5 14.285l.317-.024a6.07 6.07 0 004.5 0L12.036 14.285m6.06-2.984l-.001-.014a4.12 4.12 0 014.079-3.902m-9.06 5.686l2.81.024a6.43 6.43 0 015.014 3.985m-12.028 0l-2.81-.024a6.43 6.43 0 00-5.014-3.985m3.004-1.695l.001-.014a4.64 4.64 0 004.08 3.902M6.5 9.715l-.001.014a4.64 4.64 0 00-4.08-3.902m9.06 5.686l2.81.024a6.43 6.43 0 005.014 3.985" />
                                            </svg>
                                            View
                                        </a>
                                        <a href="{% url 'delete_report' filename=audit.report_name %}" class="text-red-400 hover:text-red-300 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 rounded-md flex items-center gap-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
                                            </svg>
                                            Delete
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" class="px-6 py-8 text-center text-sm text-gray-400">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mx-auto mb-2 text-gray-500">
                                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2-6H7m10 0v4c0 .52-.21 1-.562 1.351l-2.25 2.25c-.678.678-1.957.678-2.635 0l-2.25-2.25A1.75 1.75 0 015 16v-4c0-.52.21-1 .562-1.351l2.25-2.25c.678-.678 1.957-.678 2.635 0l2.25 2.25A1.75 1.75 0 0119 12v4c0 .52-.21 1-.562 1.351l-2.25 2.25c-.678.678-1.957.678-2.635 0l-2.25-2.25A1.75 1.75 0 0113 16v-4c0-.52.21-1 .562-1.351l2.25-2.25c.678-.678 1.957-.678 2.635 0l2.25 2.25A1.75 1.75 0 0119 12v4z" />
                                    </svg>
                                    No audits found.
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-sm text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mx-auto mb-2 text-gray-500">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                                </svg>
                                Loading audits...
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
function openDeleteModal(auditId) {
    // You can use a library like `flowbite` for modals, or implement your own simple confirm dialog:
    // Here's a basic example using a simple confirm dialog:
    const confirmed = confirm("Are you sure you want to delete this audit?");
    if (confirmed) {
        // In a real application, you would send an AJAX request to your server to delete the audit.
        // For this example, we'll just simulate a deletion.
        console.log("Deleting audit:", auditId);
        // Remove the row from the table
        const rowToDelete = document.querySelector(`[data-audit-id="${auditId}"]`);
        if (rowToDelete) {
            rowToDelete.remove();
        }
        // Redirect to delete url
        window.location.href = `/delete_audit/${auditId}`;

    } else {
      console.log("Deletion canceled")
    }
}
</script>
{% endblock content %}
